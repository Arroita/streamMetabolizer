% Generated by roxygen2 (4.1.1): do not edit by hand
% Please edit documentation in R/metab_night.R
\name{metab_night}
\alias{metab_night}
\title{Nighttime regression for K estimation}
\usage{
metab_night(data = mm_data(local.time, DO.obs, DO.sat, depth, temp.water,
  light), data_daily = mm_data(NULL), info = NULL, day_start = -12,
  day_end = 12, tests = c("full_day", "even_timesteps", "complete_data"))
}
\arguments{
\item{data}{data.frame of input data at the temporal resolution of raw
observations. Columns must have the same names, units, and format as the
default. See \code{\link{mm_data}} for a full data description.}

\item{data_daily}{data.frame containing inputs with a daily timestep. See
\code{\link{mm_data}} for a full data description.}

\item{info}{any information, in any format, that you would like to store
within the metab_model object}

\item{day_start}{start time of a day's data in number of hours from the
midnight that begins the modal date. For example, day_start=-1.5 indicates
that data describing 2006-06-26 begin at 2006-06-25 22:30, or at the first
observation time that occurs after that time if day_start doesn't fall
exactly on an observation time.}

\item{day_end}{end time of a day's data in number of hours from the midnight
that begins the modal date. For example, day_end=30 indicates that data
describing 2006-06-26 end at 2006-06-27 06:00, or at the last observation
time that occurs before that time if day_end doesn't fall exactly on an
observation time.}

\item{tests}{list of tests to conduct}
}
\value{
A metab_night object containing the fitted model.
}
\description{
Fits a model to estimate K from nighttime input data on DO, temperature,
light, etc. The default day start & end are 12 noon on the preceding to
present day; the algorithm then filters the data to just those time points
for which light is very low.
}
\examples{
# set the date in several formats
start.chron <- chron::chron(dates="08/23/12", times="22:00:00")
end.chron <- chron::chron(dates="08/25/12", times="06:00:00")
start.posix <- as.POSIXct(format(start.chron, "\%Y-\%m-\%d \%H:\%M:\%S"), tz="MST")
end.posix <- as.POSIXct(format(end.chron, "\%Y-\%m-\%d \%H:\%M:\%S"), tz="MST")
mid.date <- as.Date(start.posix + (end.posix - start.posix)/2)

# get, format, & subset data
vfrench <- streamMetabolizer:::load_french_creek(attach.units=FALSE)
vfrenchshort <- vfrench[vfrench$local.time >= start.posix & vfrench$local.time <= end.posix, ]

# dates & subsetting specific to nighttime regression
first.dark <- 100 + which(vfrenchshort$light[101:nrow(vfrenchshort)] < 0.1)[1]
stop.dark <- 100 + which(
  format(vfrenchshort$local.time[101:nrow(vfrenchshort)], "\%H:\%M") == "23:00")[1]
vfrenchnight <- vfrenchshort[first.dark:stop.dark,]
night.start <- eval(parse(text=format(vfrenchnight$local.time[1], "\%H + \%M/60")))
night.end <- eval(parse(text=format(vfrenchnight$local.time[nrow(vfrenchnight)], "\%H + \%M/60")))

# K (metab_night)
predict_metab(metab_night(data=vfrenchnight, day_start=night.start,
  day_end=night.end))[c("GPP","ER","K600")]
streamMetabolizer:::load_french_creek_std_mle(vfrenchnight, estimate='K')

\dontrun{
 metab_night(data=data.frame(empty="shouldbreak"))
}
}
\author{
Alison Appling, Maite Arroita
}
\seealso{
Other metab_model: \code{\link{metab_Kvpred}};
  \code{\link{metab_bayes}}; \code{\link{metab_mle}};
  \code{\link{metab_sim}}
}


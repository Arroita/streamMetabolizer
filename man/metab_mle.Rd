% Generated by roxygen2 (4.1.1): do not edit by hand
% Please edit documentation in R/metab_mle.R
\name{metab_mle}
\alias{metab_mle}
\title{Maximum likelihood metabolism model fitting function}
\usage{
metab_mle(data = mm_data(local.time, DO.obs, DO.sat, depth, temp.water,
  light), data_daily = mm_data(local.date, K600, optional = "all"),
  model_specs = specs_mle_nopool_oi(), info = NULL, day_start = 4,
  day_end = 27.99, tests = c("full_day", "even_timesteps", "complete_data"))
}
\arguments{
\item{data}{data.frame of input data at the temporal resolution of raw
observations. Columns must have the same names, units, and format as the
default. See \code{\link{mm_data}} for a full data description.}

\item{data_daily}{data.frame containing inputs with a daily timestep. See
\code{\link{mm_data}} for a full data description.}

\item{model_specs}{a list of model specifications and parameters for a model.
Although this may be specified manually, it is easier to use a predefined
function from the \code{specs_xxx} family with a name beginning with
"specs_xxx", where "xxx" is the model type - e.g., "mle", "bayes", "night",
etc. The help files for those functions list the necessary parameters,
describe them in detail, and give default values.}

\item{info}{any information, in any format, that you would like to store
within the metab_model object}

\item{day_start}{start time (inclusive) of a day's data in number of hours
from the midnight that begins the date. For example, day_start=-1.5
indicates that data describing 2006-06-26 begin at 2006-06-25 22:30, or at
the first observation time that occurs after that time if day_start doesn't
fall exactly on an observation time. For single days of input data, it is
conventional/useful to begin the day the evening before, e.g., -1.5, and to
end just before the next sunrise, e.g., 30. For multiple consecutive days,
it may make the most sense to start just before sunrise (e.g., 4) and to
end 24 hours later. For nighttime regression to be compatible with this
setup, the date assigned to a section of data should be the date whose
evening contains the data. The default is therefore 12 to 36 for
metab_night, of which the times of darkness will be used.}

\item{day_end}{end time (inclusive) of a day's data in number of hours from
the midnight that begins the date. For example, day_end=30 indicates that
data describing 2006-06-26 end at 2006-06-27 06:00, or at the last
observation time that occurs before that time if day_end doesn't fall
exactly on an observation time. See day_start for recommended start and end
times.}

\item{tests}{list of tests to conduct}
}
\value{
A metab_mle object containing the fitted model.
}
\description{
Fits a model to estimate GPP and ER from input data on DO, temperature,
light, etc.
}
\examples{
# set the date in several formats
start.chron <- chron::chron(dates="08/23/12", times="22:00:00")
end.chron <- chron::chron(dates="08/25/12", times="06:00:00")
start.posix <- as.POSIXct(format(start.chron, "\%Y-\%m-\%d \%H:\%M:\%S"), tz="Etc/GMT+7")
end.posix <- as.POSIXct(format(end.chron, "\%Y-\%m-\%d \%H:\%M:\%S"), tz="Etc/GMT+7")
mid.date <- as.Date(start.posix + (end.posix - start.posix)/2)
start.numeric <- as.numeric(start.posix - as.POSIXct(format(mid.date, "\%Y-\%m-\%d 00:00:00"),
   tz="Etc/GMT+7"), units='hours')
end.numeric <- as.numeric(end.posix - as.POSIXct(format(mid.date, "\%Y-\%m-\%d 00:00:00"),
  tz="Etc/GMT+7"), units='hours')

# get, format, & subset data
vfrench <- streamMetabolizer:::load_french_creek(attach.units=FALSE)
vfrenchshort <- vfrench[vfrench$local.time >= start.posix & vfrench$local.time <= end.posix, ]

# PRK
get_fit(mm <- metab_mle(data=vfrenchshort, day_start=start.numeric,
  day_end=end.numeric))[2,c("GPP","ER","K600","minimum")]
plot_DO_preds(predict_DO(mm))
streamMetabolizer:::load_french_creek_std_mle(vfrenchshort, estimate='PRK')

# PR
get_fit(mm <- metab_mle(data=vfrenchshort, data_daily=data.frame(local.date=mid.date, K600=35),
  day_start=start.numeric, day_end=end.numeric))[2,c("GPP","ER","K600","minimum")]
get_fitting_time(mm)
plot_DO_preds(predict_DO(mm))
streamMetabolizer:::load_french_creek_std_mle(vfrenchshort, estimate='PR', K=35)

\dontrun{
  metab_mle(data=data.frame(empty="shouldbreak"))

  # PRK and PR with process error
  get_fit(mm <- metab_mle(data=vfrenchshort,
    model_specs=specs_mle_nopool_pi(),
    day_start=start.numeric, day_end=end.numeric))[2,c("GPP","ER","K600","minimum")]
  plot_DO_preds(predict_DO(mm))
  get_fit(mm <- metab_mle(data=vfrenchshort, data_daily=data.frame(local.date=mid.date, K600=35),
    model_specs=specs_mle_nopool_pi(),
    day_start=start.numeric, day_end=end.numeric))[2,c("GPP","ER","K600","minimum")]
  plot_DO_preds(predict_DO(mm))
}
}
\author{
Alison Appling, Jordan Read; modeled on LakeMetabolizer
}
\seealso{
Other metab_model: \code{\link{metab_Kvpred}};
  \code{\link{metab_bayes}}; \code{\link{metab_night}};
  \code{\link{metab_sim}}
}

